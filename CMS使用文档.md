# 反诈卫士 - CMS 内容管理系统使用文档

<div align="center">

📝 **微信云开发 CMS 使用指南**

适用于管理员和内容运营人员

</div>

---

## 📋 目录

- [1. CMS 简介](#1-cms-简介)
- [2. 开通 CMS 服务](#2-开通-cms-服务)
- [3. 创建内容模型](#3-创建内容模型)
- [4. 文章管理](#4-文章管理)
- [5. 轮播图管理](#5-轮播图管理)
- [6. 用户数据查看](#6-用户数据查看)
- [7. 权限管理](#7-权限管理)
- [8. 常见问题](#8-常见问题)

---

## 1. CMS 简介

### 什么是微信云开发 CMS？

微信云开发内容管理（CMS）是一个扩展程序，可以在可视化界面中管理云开发的数据，无需编写代码即可对内容进行增删改查。

### 适用场景

- ✅ 文章、新闻、公告发布
- ✅ 轮播图、活动海报管理
- ✅ 用户数据查询与导出
- ✅ 内容审核与发布流程

### CMS vs 云数据库控制台

| 对比项 | CMS | 云数据库控制台 |
|-------|-----|--------------|
| 使用难度 | ⭐ 简单易用 | ⭐⭐ 需要技术基础 |
| 界面友好度 | 图形化表单 | JSON 编辑器 |
| 富文本编辑 | ✅ 支持 | ❌ 不支持 |
| 图片上传 | ✅ 可视化 | ❌ 需要先上传云存储 |
| 内容审核 | ✅ 支持草稿/发布 | ❌ 不支持 |
| 权限管理 | ✅ 细粒度控制 | ⭐⭐ 基础权限 |

---

## 2. 开通 CMS 服务

### 步骤 1：进入云开发控制台

1. 打开[微信公众平台](https://mp.weixin.qq.com/)
2. 登录小程序账号
3. 左侧菜单选择 **开发** > **开发管理** > **开发设置**
4. 找到 **云开发** 部分，点击**进入云开发控制台**

### 步骤 2：安装 CMS 扩展

1. 在云开发控制台，点击左侧 **扩展能力**
2. 找到 **内容管理（CMS）**
3. 点击 **开通**
4. 选择你的云环境（如 `cloud1-9g3v8lt8fb0108e7`）
5. 确认开通（免费）

### 步骤 3：访问 CMS

开通成功后，有两种方式访问 CMS：

**方式 1：通过控制台**
- 云开发控制台 > 扩展能力 > 内容管理 > 点击 **进入**

**方式 2：直接访问**
- 浏览器打开：`https://console.cloud.tencent.com/tcb/cms`
- 选择对应的云环境

---

## 3. 创建内容模型

内容模型定义了数据的结构（类似于数据库的表结构）。

### 3.1 创建"文章"模型

#### 步骤：
1. 进入 CMS，点击 **内容模型** > **创建内容模型**
2. 填写基本信息：
   - **模型 ID**: `articles`（对应数据库集合名称）
   - **模型名称**: `反诈骗文章`
   - **描述**: `管理反诈骗知识文章`

3. 添加字段：

| 字段 ID | 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|---------|------|
| `title` | 文章标题 | 单行文本 | ✅ 是 | 最多100字 |
| `tag` | 文章标签 | 枚举 | ✅ 是 | 选项：紧急预警/案例分析/防骗知识/知识科普/视频教程 |
| `tagType` | 标签类型 | 枚举 | ✅ 是 | 选项：danger/warning/info |
| `category` | 分类 | 枚举 | ✅ 是 | 选项：大学生/刷单诈骗/校园贷/电信诈骗/网购退款/杀猪盘/投资理财 |
| `content` | 文章内容 | 富文本 | ✅ 是 | 支持图片、视频、格式化文本 |
| `coverImage` | 封面图 | 图片 | ❌ 否 | 推荐尺寸：750x400 |
| `author` | 作者 | 单行文本 | ❌ 否 | 默认：反诈小助手 |
| `views` | 浏览量 | 数字 | ❌ 否 | 默认：0 |
| `timestamp` | 发布时间 | 日期时间 | ✅ 是 | 自动填充当前时间 |
| `status` | 状态 | 枚举 | ✅ 是 | 选项：1=草稿, 2=已发布 |

4. 保存模型

### 3.2 创建"轮播图"模型

#### 步骤：
1. 创建内容模型
   - **模型 ID**: `banners`
   - **模型名称**: `首页轮播图`

2. 添加字段：

| 字段 ID | 字段名称 | 字段类型 | 是否必填 | 说明 |
|---------|---------|---------|---------|------|
| `title` | 标题 | 单行文本 | ✅ 是 | 如：防范电信诈骗 |
| `desc` | 描述 | 单行文本 | ❌ 否 | 如：守护你的钱包安全 |
| `icon` | 图标 | 单行文本 | ❌ 否 | 支持emoji或图标URL |
| `image` | 轮播图片 | 图片 | ❌ 否 | 推荐尺寸：750x300 |
| `bgColor` | 背景色 | 单行文本 | ❌ 否 | CSS颜色值或渐变 |
| `link` | 跳转链接 | 单行文本 | ❌ 否 | 小程序页面路径 |
| `sort` | 排序 | 数字 | ✅ 是 | 数字越小越靠前 |
| `status` | 是否启用 | 布尔值 | ✅ 是 | true=启用, false=禁用 |

3. 保存模型

---

## 4. 文章管理

### 4.1 创建新文章

1. 进入 CMS，点击 **内容集合** > **反诈骗文章**
2. 点击右上角 **新建内容**
3. 填写表单：

#### 示例：创建一篇刷单诈骗警示文章

```
✏️ 文章标题：警惕！"刷单兼职"骗局又出新花样，多名大学生被骗

🏷️ 文章标签：紧急预警
🎨 标签类型：danger
📂 分类：刷单诈骗

📝 文章内容（富文本编辑）：
========================================
近日，多名在校大学生向校保卫处报案，称遭遇"刷单兼职"诈骗，累计损失超过10万元。

【案例回顾】
小李是某高校大二学生，在QQ群中看到"日赚300+，轻松兼职"的广告...

【诈骗手法】
1. 发布高薪招聘信息
2. 小额返利建立信任
3. 诱导大额垫付
4. 以各种理由拖延返款
5. 最终失联跑路

【防范建议】
✓ 不要相信"高薪轻松"的兼职
✓ 正规企业不会让员工垫付资金
✓ 不要在非官方平台操作
✓ 遇到要求转账的立即警惕

【已被骗怎么办？】
1. 立即停止转账
2. 保存所有聊天记录、转账凭证
3. 拨打110或96110报警
========================================

🖼️ 封面图：点击上传（推荐使用反诈骗主题图片）

👤 作者：反诈小助手

👁️ 浏览量：0（系统会自动累加）

⏰ 发布时间：2026-01-14 10:30（自动填充）

📋 状态：2=已发布（选择"1=草稿"则不会在小程序显示）
```

4. 点击 **提交** 保存

### 4.2 编辑已有文章

1. 在文章列表中找到要编辑的文章
2. 点击文章标题或右侧 **编辑** 按钮
3. 修改内容
4. 点击 **提交** 保存

### 4.3 文章状态管理

| 状态 | 值 | 说明 | 小程序是否显示 |
|------|---|------|---------------|
| 草稿 | 1 | 编辑中，未发布 | ❌ 否 |
| 已发布 | 2 | 已发布，用户可见 | ✅ 是 |

**发布流程：**
1. 创建文章时选择"草稿"
2. 内容审核通过后，编辑文章
3. 将状态改为"已发布"
4. 提交保存

### 4.4 删除文章

1. 在文章列表中找到要删除的文章
2. 点击右侧 **删除** 按钮
3. 确认删除

⚠️ **注意**：删除操作不可恢复，请谨慎操作！

### 4.5 批量操作

**批量发布：**
1. 勾选多篇草稿文章
2. 点击 **批量操作** > **更新字段**
3. 选择字段：`status`，值：`2`
4. 确认

**批量删除：**
1. 勾选要删除的文章
2. 点击 **批量操作** > **删除**
3. 确认

---

## 5. 轮播图管理

### 5.1 添加轮播图

1. 进入 **内容集合** > **首页轮播图**
2. 点击 **新建内容**

#### 示例 1：使用渐变背景

```
标题：防范电信诈骗
描述：守护你的钱包安全
图标：🛡️
图片：（不填）
背景色：linear-gradient(135deg, #667eea 0%, #764ba2 100%)
跳转链接：/pages/article-detail/article-detail?id=xxx
排序：1
是否启用：✅ true
```

#### 示例 2：使用图片背景

```
标题：大学生反诈骗知识竞赛
描述：参与答题，赢取奖品
图标：🎓
图片：[点击上传图片]
背景色：（不填，优先使用图片）
跳转链接：/pages/quiz/quiz
排序：2
是否启用：✅ true
```

3. 点击 **提交** 保存

### 5.2 调整轮播图顺序

修改 **排序** 字段的数字：
- 数字越小，显示越靠前
- 建议使用 10、20、30... 便于后续插入

### 5.3 禁用轮播图

将 **是否启用** 字段设置为 `false`，轮播图将不在小程序显示。

### 5.4 上传图片

**推荐规格：**
- 尺寸：750px × 300px（宽高比 5:2）
- 格式：JPG/PNG
- 大小：≤ 500KB

**上传步骤：**
1. 点击图片字段的 **选择文件**
2. 选择本地图片
3. 等待上传完成（自动存储到云存储）
4. 提交表单

---

## 6. 用户数据查看

### 6.1 查看用户列表

虽然 `users` 集合不推荐直接在 CMS 编辑（涉及隐私），但可以查看统计数据。

**查看方式：**
1. 云开发控制台 > 数据库 > `users` 集合
2. 可以查看：
   - 用户总数
   - 活跃用户
   - 绑定学号数量
   - 签到情况

### 6.2 导出用户数据

**导出步骤：**
1. 数据库控制台 > `users` 集合
2. 点击 **导出**
3. 选择导出格式（JSON/CSV）
4. 下载到本地

**常用场景：**
- 统计分析
- 用户画像
- 数据备份

---

## 7. 权限管理

### 7.1 CMS 角色

| 角色 | 权限 | 适用人员 |
|------|------|---------|
| 管理员 | 所有权限 | 技术负责人 |
| 内容管理员 | 增删改查内容 | 运营人员 |
| 内容编辑 | 创建和编辑（不能删除） | 编辑人员 |
| 查看者 | 仅查看 | 数据分析人员 |

### 7.2 添加协作者

1. CMS 控制台 > **设置** > **协作者管理**
2. 点击 **添加协作者**
3. 输入微信号或 OpenID
4. 选择角色
5. 保存

### 7.3 数据库权限设置

在云开发控制台设置集合权限：

**推荐配置：**

| 集合 | 读权限 | 写权限 |
|------|--------|--------|
| `articles` | 所有用户 | 仅管理员 |
| `banners` | 所有用户 | 仅管理员 |
| `users` | 仅创建者 | 仅创建者 |
| `bind_logs` | 仅创建者 | 仅创建者 |

**设置方式：**
1. 数据库 > 选择集合 > **权限设置**
2. 选择权限模式
3. 保存

---

## 8. 常见问题

### Q1: 为什么小程序看不到我刚发布的文章？

**可能原因：**
1. ❌ 文章状态仍为"草稿"（status = 1）
   - **解决**：改为"已发布"（status = 2）

2. ❌ 小程序缓存未刷新
   - **解决**：下拉刷新页面

3. ❌ 云数据库权限设置错误
   - **解决**：检查 `articles` 集合读权限是否为"所有用户"

### Q2: 上传的图片在小程序显示不出来？

**可能原因：**
1. ❌ 图片路径格式错误
   - **正确格式**：`cloud://env-id.xxx/path/to/image.jpg`
   
2. ❌ 云存储权限设置错误
   - **解决**：云存储 > 权限设置 > 所有用户可读

3. ❌ 图片未获取临时链接
   - **解决**：检查小程序代码中是否调用 `wx.cloud.getTempFileURL()`

### Q3: 如何批量导入文章？

**方法 1：使用数据库控制台**
1. 准备 JSON 格式的数据文件
2. 数据库 > `articles` 集合 > **导入**
3. 上传文件

**方法 2：使用云函数脚本**
```javascript
// 编写云函数批量插入
const db = cloud.database();
const articles = [
  { title: '文章1', content: '...', status: '2' },
  { title: '文章2', content: '...', status: '2' }
];

for (let article of articles) {
  await db.collection('articles').add({ data: article });
}
```

### Q4: 如何备份内容？

**定期备份建议：**
1. 每周导出一次数据库（JSON 格式）
2. 保存到本地或云盘
3. 重要更新前手动备份

**自动备份（企业版）：**
- 开通云开发企业版
- 启用自动备份功能

### Q5: 富文本编辑器支持哪些功能？

**支持的功能：**
- ✅ 标题、段落、列表
- ✅ 加粗、斜体、下划线
- ✅ 插入图片
- ✅ 插入链接
- ✅ 插入视频（云存储）
- ✅ 代码块

**不支持的功能：**
- ❌ 表格（需手动编写HTML）
- ❌ 音频（可用视频代替）

### Q6: 如何设置文章的浏览量？

**方式 1：CMS 手动设置**
- 编辑文章，修改 `views` 字段

**方式 2：代码自动增加**
- 已在小程序代码中实现（`index.js` 中的 `incrementViews` 方法）
- 每次点击文章，浏览量自动 +1

### Q7: 如何审核文章内容？

**审核流程建议：**
1. 编辑创建文章，状态选择"草稿"
2. 管理员在 CMS 中审核内容
3. 审核通过后，改为"已发布"
4. 审核不通过，添加审核意见并退回

**实现方式：**
- 可以添加 `auditStatus` 字段（待审核/通过/拒绝）
- 添加 `auditNote` 字段（审核意见）

### Q8: 轮播图加载失败怎么办？

**排查步骤：**
1. 检查图片是否成功上传到云存储
2. 检查 `status` 字段是否为 `true`
3. 查看小程序控制台是否有错误提示
4. 检查图片格式和大小是否符合要求

**降级方案：**
- 小程序代码中已实现默认轮播图
- 云端加载失败时，自动使用本地默认数据

---

## 📌 最佳实践

### ✅ 内容规范
1. **标题**：简洁有力，不超过30字
2. **封面图**：统一尺寸，美观醒目
3. **正文**：分段清晰，使用列表和小标题
4. **标签**：准确分类，便于用户筛选

### ✅ 更新频率
- 每周至少发布 **2-3篇** 原创文章
- 紧急预警实时更新
- 定期更新轮播图（节假日、活动）

### ✅ 数据监控
- 定期查看文章浏览量
- 分析热门分类
- 根据数据调整内容策略

### ✅ 安全建议
- 定期备份数据
- 不要在 CMS 中存储敏感信息
- 及时更新协作者权限

---

## 📞 技术支持

遇到问题？联系技术团队：

- **技术文档**: [微信云开发官方文档](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html)
- **CMS 文档**: [内容管理 CMS](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/extensions/cms/introduction.html)
- **项目负责人**: （填写联系方式）

---

## 📝 更新日志

| 日期 | 版本 | 更新内容 |
|------|------|---------|
| 2026-01-14 | v1.0 | 初始版本，完成基础文档 |

---

<div align="center">

**💡 提示：本文档会持续更新，建议收藏备用！**

</div>
