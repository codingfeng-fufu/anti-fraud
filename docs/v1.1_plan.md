# 反诈卫士小程序 v1.1 版本更新计划

## 📋 优化方案概览

### 核心改进点
1. **成就系统升级** - 基于签到、对话、学习数自动授予称号
2. **称号系统** - 成就自动获得 + 积分兑换主题趣味称号
3. **多称号佩戴** - 用户可同时佩戴多个称号
4. **用户管理优化** - 展示称号和统计数据

---

## 🗄️ 一、数据库设计

### 1. 新增 `titles` 集合（称号定义）
```javascript
{
  _id: 自动生成,
  titleId: "唯一标识",         // 如: chat_expert_100, anti_fraud_pioneer
  name: "称号名称",            // 如: 对话达人, 反诈先锋
  desc: "称号描述",            
  icon: "🏆",                   
  type: "achievement|redeem",   // achievement: 成就奖励, redeem: 积分兑换
  rarity: "common|rare|epic",   
  condition: {},               
  points: 100,                  // 兑换所需积分（redeem类型）
  achievementId: "",            // 关联成就ID（achievement类型）
  isActive: true,
  createdAt: Date
}
```

### 2. 修改 `users` 集合
添加字段：
- `titles`: [] - 已获得的称号ID数组
- `equippedTitles`: [] - 当前佩戴的称号ID数组
- `continuousLearnDays`: 0 - 连续学习天数

### 3. 修改 `user_achievements` 集合
添加字段：
- `rewardTitleId`: "" - 成就奖励的称号ID

---

## ☁️ 二、云函数开发

### 新增云函数
1. **getTitles** - 获取称号列表（区分可兑换/已获得）
2. **redeemTitle** - 积分兑换称号
3. **equipTitle** - 佩戴/卸下称号（支持多称号）
4. **trackAction** - 统一追踪用户行为（阅读、对话），自动检查成就

### 修改现有云函数
- **login**: 初始化称号字段
- **userSignIn**: 增强成就检查，自动授予称号
- **aiChat**: 调用trackAction记录对话

---

## 🏆 三、称号和成就设计

### 成就系统（自动获得称号）

**对话类成就**
| 成就ID | 名称 | 条件 | 称号ID | 称号 | 积分 |
|--------|------|------|--------|------|------|
| chat_10 | 积极提问 | 对话10次 | chat_expert_10 | 对话新手 | 50 |
| chat_50 | 防诈专家 | 对话50次 | chat_expert_50 | 对话达人 | 200 |
| chat_100 | 博学多才 | 对话100次 | chat_expert_100 | 对话大师 | 500 |

**学习类成就**
| 成就ID | 名称 | 条件 | 称号ID | 称号 | 积分 |
|--------|------|------|--------|------|------|
| read_10 | 博览群书 | 阅读10篇 | learn_expert_10 | 求知者 | 100 |
| read_50 | 反诈达人 | 阅读50篇 | learn_expert_50 | 博学者 | 500 |
| learn_7 | 自律之星 | 连续学习7天 | learn_star_7 | 自律之星 | 100 |

**兑换类称号（积分兑换主题趣味称号）**
| 称号ID | 名称 | 描述 | 所需积分 | 稀有度 |
|--------|------|------|----------|--------|
| anti_fraud_pioneer | 反诈先锋 | 致力于反诈骗事业 | 100 | 稀有 |
| guardian_of_truth | 真理守护者 | 守护真相，远离诈骗 | 200 | 稀有 |
| wisdom_seeker | 智慧追寻者 | 追寻智慧，防范风险 | 300 | 罕见 |
| hero_of_safety | 安全卫士 | 保卫安全，抵制诈骗 | 500 | 传说 |

---

## 📱 四、前端页面优化

### 1. 用户管理页面 (`pages/user/user`)
- 添加称号展示区域
- 增加称号管理入口
- 优化统计数据展示
- 通过在“我的”页面点击上方用户昵称区域跳转

### 2. 成就页面 (`pages/achievements/achievements`)
- 按类型分类展示成就
- 添加称号预览功能
- 强化成就解锁动画效果

### 3. 积分商城页面 (`pages/points/points`)
- 新增称号兑换专区
- 优化商品分类展示
- 改进兑换流程体验

---

## 🚀 五、实施计划

### 第一阶段：数据库和后端开发
1. 创建 `titles` 集合
2. 修改 `users` 和 `user_achievements` 集合结构
3. 开发新增云函数
4. 修改现有云函数逻辑

### 第二阶段：前端开发
1. 更新用户管理页面
2. 优化成就页面
3. 优化积分商城页面
4. 测试各功能模块

### 第三阶段：测试和发布
1. 功能完整性测试

---

2. **兼容性**：保持与现有功能的兼容
3. **性能优化**：确保新增功能不影响系统性能
4. **用户体验**：保持界面简洁美观

此更新计划将显著提升反诈卫士小程序的用户参与度和体验质量。