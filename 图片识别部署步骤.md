# 图片识别功能部署步骤

## 当前状态
✅ 后端代码已完成（OCR + 文本分析方案）
✅ 前端代码已恢复（图片上传功能）
⏳ 等待云函数部署

## 部署步骤

### 1. 等待云函数解锁（10-15分钟）
云函数当前处于 "Updating" 状态，需要等待自动解锁。

**检查方法：**
- 在微信开发者工具中，右键点击 `cloudfunctions/aiChat` 文件夹
- 如果看到"上传并部署"选项可用，说明已解锁

### 2. 清除缓存
在微信开发者工具中：
1. 点击顶部菜单：项目 → 清除缓存
2. 选择"清除全部缓存"
3. 点击"清除"

### 3. 部署云函数
1. 右键点击 `cloudfunctions/aiChat` 文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成（约1-2分钟）

**成功标志：**
- 控制台显示"上传成功"
- 云函数图标变为绿色

### 4. 重新编译小程序
1. 点击开发者工具顶部的"编译"按钮
2. 等待编译完成

### 5. 测试功能

#### 测试文字聊天：
1. 在聊天页面输入："什么是刷单骗局？"
2. 检查AI是否正常回复

#### 测试图片识别：
1. 点击聊天输入框右侧的"图片"按钮
2. 选择一张包含文字的图片（如诈骗短信截图）
3. 等待识别结果（约3-5秒）
4. 检查AI是否分析了图片中的文字内容

## 技术方案说明

### 免费OCR方案
- **步骤1**：使用微信云开发的 OCR 识别图片文字（免费）
- **步骤2**：将提取的文字发送给通义千问文本模型分析（免费额度内）

### 优点
✅ 完全免费
✅ 适合反诈骗场景（大多数诈骗截图都包含文字）
✅ 无需额外配置多模态API

### 限制
⚠️ 只能识别图片中的文字，无法理解图片内容
⚠️ 如果图片没有文字，会提示用户用文字描述

## 如果部署失败

### 方法1：通过腾讯云控制台部署
1. 访问：https://console.cloud.tencent.com/scf
2. 找到 `aiChat` 云函数
3. 检查状态，如果是"更新中"，等待完成
4. 手动上传代码包

### 方法2：删除并重新创建
1. 在腾讯云控制台删除 `aiChat` 云函数
2. 在微信开发者工具中重新创建并部署

### 方法3：联系技术支持
如果以上方法都失败，可以联系腾讯云技术支持。

## 后续优化建议

### 提升AI回答质量
当前使用 `qwen-turbo` 模型（最便宜但能力较弱）

**升级方案：**
修改 `cloudfunctions/aiChat/index.js` 第18行：
```javascript
const QWEN_MODEL = 'qwen-plus'  // 改为 qwen-plus
```

**成本对比：**
- qwen-turbo: ¥0.0008/1K tokens（当前）
- qwen-plus: ¥0.004/1K tokens（5倍价格，质量更好）

### 启用真正的多模态识别
如果需要识别图片内容（不只是文字），需要：
1. 在阿里云控制台开通 Qwen-VL 服务
2. 修改代码使用 `qwen-vl-plus` 模型
3. 成本会增加（多模态API更贵）

## 常见问题

**Q: 图片识别很慢？**
A: OCR识别需要3-5秒，这是正常的。可以优化提示文案。

**Q: 识别不出图片内容？**
A: 确保图片清晰，包含文字。如果是纯图片（无文字），当前方案无法识别。

**Q: AI回答太简单？**
A: 升级到 `qwen-plus` 模型，并增加 `max_tokens` 参数。

**Q: 云函数超时？**
A: 在腾讯云控制台将云函数超时时间改为20秒。

## 联系方式
如有问题，请联系开发团队。
