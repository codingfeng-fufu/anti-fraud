# 反诈卫士小程序项目架构文档

## 项目概述

反诈卫士是一款面向大学生的反诈骗教育小程序，旨在通过游戏化的方式提高学生的反诈骗意识和技能。项目包含用户管理、签到积分、成就系统、积分商城、文章阅读和AI对话等功能模块。

## 架构层次

### 1. 前端层 (Pages)
- **用户界面**：提供直观易用的用户交互界面
- **页面路由**：管理小程序页面间的跳转和通信
- **本地存储**：缓存用户数据和应用状态

### 2. 云函数层 (Cloud Functions)
- **业务逻辑**：处理复杂的业务规则和数据操作
- **安全验证**：确保数据访问的安全性和合法性
- **第三方API集成**：连接外部服务（如AI模型）

### 3. 数据层 (Cloud Database)
- **用户数据**：存储用户信息、积分、成就等
- **内容数据**：管理反诈文章、公告等内容
- **行为记录**：跟踪用户活动和交互历史

## 模块设计

### 用户管理系统
- **功能**：用户注册、登录、信息管理
- **数据流**：用户输入 → 验证 → 云端存储 → 本地缓存
- **关键文件**：`/pages/user/user.js`, `/cloudfunctions/login/index.js`

### 签到积分系统
- **功能**：每日签到、积分获取、连续签到奖励
- **数据流**：签到请求 → 云端验证 → 数据更新 → 本地同步
- **关键文件**：`/pages/user/user.js`, `/cloudfunctions/userSignIn/index.js`

### 成就系统
- **功能**：成就解锁、进度追踪、奖励发放
- **数据流**：用户行为 → 成就检查 → 成就授予 → 界面更新
- **关键文件**：`/pages/achievements/achievements.js`, `/cloudfunctions/userSignIn/index.js`

### 积分商城系统
- **功能**：商品展示、积分兑换、兑换记录
- **数据流**：商品浏览 → 积分验证 → 兑换处理 → 记录更新
- **关键文件**：`/pages/points/points.js`, `/cloudfunctions/rewardSystem/index.js`

### AI对话系统
- **功能**：智能问答、反诈咨询、对话记录
- **数据流**：用户提问 → AI处理 → 回答返回 → 记录保存
- **关键文件**：`/pages/chat/chat.js`, `/cloudfunctions/aiChat/index.js`

## 数据流向

```
用户交互 → 前端页面 → 云函数 → 数据库 ←→ 云函数 ←→ 前端页面 → 界面更新
```

## 安全策略

- **数据加密**：敏感信息传输加密
- **权限控制**：基于用户身份的数据访问控制
- **输入验证**：前后端双重输入验证
- **频率限制**：防止恶意刷取积分或滥用API

## 性能优化

- **本地缓存**：减少网络请求，提升用户体验
- **数据分页**：大数据量分批加载
- **懒加载**：按需加载资源
- **CDN加速**：静态资源加速访问

## 扩展性考虑

- **微服务架构**：云函数模块化设计
- **配置驱动**：可通过配置调整业务规则
- **插件机制**：预留功能扩展接口
- **版本兼容**：向下兼容的API设计

## 重要说明

**每当所属的代码发生变化时，必须对相应的文档进行更新操作！**