<!--
è¶£å‘³ç­”é¢˜é¡µé¢ - è¶£å‘³ç­”é¢˜æ¨¡å— (v3)

ä¸Šæ¸¸ä¾èµ–ï¼šäº‘å‡½æ•°(getQuizQuestions/submitQuizAttempt)
å…¥å£ï¼š/pages/quiz/quiz
ä¸»è¦åŠŸèƒ½ï¼šéšæœºæŠ½å–10é¢˜ï¼Œç­”é¢˜åæœåŠ¡ç«¯åˆ¤åˆ†ï¼Œå‘æ”¾ç§¯åˆ†ä¸å±•ç¤ºè§£æ
è¾“å‡ºï¼šç­”é¢˜ç»“æœä¸ç§¯åˆ†æç¤ºï¼Œå¯è·³è½¬æ’è¡Œæ¦œ

é‡è¦ï¼šæ¯å½“æ‰€å±çš„ä»£ç å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¿…é¡»å¯¹ç›¸åº”çš„æ–‡æ¡£è¿›è¡Œæ›´æ–°æ“ä½œï¼
-->
<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œæ  -->
  <view class="top-bar">
    <view class="header-right" bindtap="goLeaderboard"><text class="rank-btn">ğŸ† æ’è¡Œæ¦œ</text></view>
  </view>

  <view wx:if="{{loading}}" class="loading">åŠ è½½é¢˜ç›®ä¸­...</view>

  <!-- ç­”é¢˜åŒº -->
  <view wx:if="{{!loading && !submitted && currentQuestion}}" class="card">
    <view class="progress">ç¬¬ {{currentIndex + 1}} / {{questions.length}} é¢˜</view>
    <view class="question">{{currentQuestion.question}}</view>

    <view class="options">
      <view wx:for="{{currentQuestion.options}}" wx:key="index"
        class="option {{selectedIndex === index ? 'selected' : ''}}"
        bindtap="selectOption" data-index="{{index}}">
        <text class="opt-key">{{['A','B','C','D'][index]}}</text>
        <text class="opt-text">{{item}}</text>
      </view>
    </view>

    <view class="actions">
      <button class="btn secondary" bindtap="prev" disabled="{{currentIndex === 0}}">ä¸Šä¸€é¢˜</button>
      <button class="btn" bindtap="nextOrSubmit">{{currentIndex === questions.length - 1 ? 'äº¤å·' : 'ä¸‹ä¸€é¢˜'}}</button>
    </view>
  </view>

  <!-- ç»“æœåŒº -->
  <view wx:if="{{submitted}}" class="result">
    <view class="result-card">
      <view class="score">æœ¬æ¬¡ç­”å¯¹ {{result.correctCount}} / {{questions.length}}</view>
      <view class="gain">
        <view>æ’è¡Œæ¦œç§¯åˆ† +{{result.earnedQuizPoints}}</view>
        <view>å•†åŸç§¯åˆ† +{{result.earnedMallPoints}}ï¼ˆä»Šæ—¥ {{result.dailyAwarded}}/{{result.dailyCap}}ï¼‰</view>
      </view>
      <view class="result-actions">
        <button class="btn" bindtap="restart">å†æ¥ä¸€å±€</button>
        <button class="btn secondary" bindtap="goLeaderboard">æŸ¥çœ‹æ’è¡Œæ¦œ</button>
      </view>
    </view>

    <view class="analysis-card">
      <view class="analysis-title">ç­”é¢˜è§£æ</view>
      <view wx:for="{{result.results}}" wx:key="questionId" class="analysis-item">
        <view class="analysis-q">
          <text class="tag {{item.correct ? 'ok' : 'bad'}}">{{item.correct ? 'æ­£ç¡®' : 'é”™è¯¯'}}</text>
          <text class="qid">{{item.questionId}}</text>
        </view>
        <view class="analysis-exp">{{item.explanation}}</view>
      </view>
    </view>
  </view>
</view>