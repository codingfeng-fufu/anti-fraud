<!--pages/chat/chat.wxml-->
<view class="chat-container">
  <!-- é¡¶éƒ¨å·¥å…·æ  -->
  <view class="chat-toolbar" wx:if="{{messages.length > 0}}">
    <button class="clear-btn" bindtap="clearLocalMessages">
      <text>ğŸ—‘ï¸ æ¸…é™¤å†å²</text>
    </button>
  </view>
  <!-- èŠå¤©æ¶ˆæ¯åŒºåŸŸ -->
  <scroll-view class="chat-messages" scroll-y scroll-into-view="{{scrollToView}}" scroll-with-animation>
    <!-- æ¬¢è¿æ¶ˆæ¯ -->
    <view class="message bot">
      <view class="message-avatar">ğŸ¤–</view>
      <view class="message-content">
        <text class="privacy-text">{{privacyText}}</text>
        <text class="welcome-text">{{welcomeMessage}}</text>
      </view>
    </view>

    <!-- èŠå¤©è®°å½• -->
    <view wx:for="{{messages}}" wx:key="id" class="message {{item.role}}" id="msg-{{index}}">
      <view class="message-avatar">{{item.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¤–'}}</view>
      <view class="message-content">
        <image wx:if="{{item.imageUrl}}" class="message-image" src="{{item.imageUrl}}" mode="widthFix" />
        <text>{{item.content}}</text>
      </view>
    </view>

    <!-- åŠ è½½ä¸­æç¤º -->
    <view wx:if="{{loading}}" class="message bot">
      <view class="message-avatar">ğŸ¤–</view>
      <view class="message-content loading-text">
        <text>æ­£åœ¨æ€è€ƒä¸­...</text>
      </view>
    </view>
  </scroll-view>

  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="chat-input-area">
    <!-- æŒ‰é’®è¡Œ -->
    <view class="input-buttons">
      <button class="upload-btn" bindtap="uploadImage">ğŸ“·</button>
      <button class="send-btn" bindtap="sendMessage">å‘é€</button>
    </view>
    <!-- è¾“å…¥æ¡† -->
    <input 
      class="chat-input" 
      type="text" 
      placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜ï¼Œç‚¹å‡»ä¸Šæ–¹ã€Œå‘é€ã€æŒ‰é’®..."
      placeholder-style="color: #94a3b8; font-size: 28rpx;"
      value="{{inputValue}}"
      bindinput="onInput"
      bindconfirm="sendMessage"
      confirm-type="send"
      cursor-spacing="20"
    />
  </view>
</view>

