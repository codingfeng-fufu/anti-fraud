<!--
ç”¨æˆ·èƒŒåŒ…é¡µé¢ - èƒŒåŒ…ç³»ç»Ÿæ¨¡å—

ä¸Šæ¸¸ä¾èµ–ï¼šbackpack.jsé¡µé¢é€»è¾‘ï¼Œbackpack.wxssæ ·å¼æ–‡ä»¶
å…¥å£ï¼šé€šè¿‡"ç§¯åˆ†å•†åŸ"é¡µé¢è·³è½¬è‡³/pages/backpack/backpack
ä¸»è¦åŠŸèƒ½ï¼šå±•ç¤ºç”¨æˆ·èƒŒåŒ…ä¸­çš„è™šæ‹Ÿå•†å“ã€é“å…·å¡ã€å®ä½“å•†å“ï¼Œæ˜¾ç¤ºç”Ÿæ•ˆä¸­çš„å¡ç‰‡
è¾“å‡ºï¼šæ¸²æŸ“èƒŒåŒ…ç•Œé¢ï¼Œè§¦å‘äº‹ä»¶å¤„ç†å™¨

é‡è¦ï¼šæ¯å½“æ‰€å±çš„ä»£ç å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¿…é¡»å¯¹ç›¸åº”çš„æ–‡æ¡£è¿›è¡Œæ›´æ–°æ“ä½œï¼
-->
<view class="backpack-container">
  <!-- é¡¶éƒ¨å¯¼èˆª -->
  <view class="page-header">
    <view class="header-left" bindtap="goBack">
      <text class="back-icon">â€¹</text>
    </view>
    <view class="header-title">æˆ‘çš„èƒŒåŒ…</view>
    <view class="header-right"></view>
  </view>

  <!-- ç»Ÿè®¡å¡ç‰‡ -->
  <view class="stats-card">
    <view class="stats-grid">
      <view class="stat-item">
        <view class="stat-value">{{stats.total}}</view>
        <view class="stat-label">èƒŒåŒ…ç‰©å“</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{stats.unused}}</view>
        <view class="stat-label">æœªä½¿ç”¨</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{stats.active}}</view>
        <view class="stat-label">ç”Ÿæ•ˆä¸­</view>
      </view>
    </view>
  </view>

  <!-- ç”Ÿæ•ˆä¸­çš„åŒå€ç§¯åˆ†å¡ -->
  <view wx:if="{{activeCards.length > 0}}" class="active-cards-section">
    <view class="section-title">ç”Ÿæ•ˆä¸­ï¼ˆ{{activeCards.length}}ï¼‰</view>
    <view class="active-cards-list">
      <view wx:for="{{activeCards}}" wx:key="_id" class="active-card">
        <view class="card-icon">âœ¨</view>
        <view class="card-info">
          <view class="card-name">{{item.itemName}}</view>
          <view class="card-expire">æœ‰æ•ˆæœŸè‡³{{item.expireAt}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç­›é€‰ -->
  <view class="category-filter">
    <scroll-view scroll-x class="category-scroll">
      <view class="category-list">
        <view 
          wx:for="{{categories}}" 
          wx:key="*this"
          class="category-item {{currentCategory === item ? 'active' : ''}}"
          bindtap="switchCategory"
          data-category="{{item}}"
        >
          <text class="category-text">{{item === 'all' ? 'å…¨éƒ¨' : item === 'virtual' ? 'è™šæ‹Ÿå•†å“' : item === 'tool' ? 'é“å…·å¡' : 'å®ä½“å•†å“'}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- èƒŒåŒ…åˆ—è¡¨ -->
  <view class="backpack-list">
    <view wx:if="{{backpack.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ’</text>
      <view class="empty-text">èƒŒåŒ…æ˜¯ç©ºçš„</view>
      <view class="empty-hint">å»ç§¯åˆ†å•†åŸå…‘æ¢å•†å“å§ï¼</view>
    </view>

    <view wx:for="{{backpack}}" wx:key="_id" class="backpack-item">
      <view class="item-icon">{{getItemIcon(item.itemType)}}</view>
      <view class="item-content">
        <view class="item-name">{{item.itemName}}</view>
        <view class="item-meta">
          <text class="item-category">{{getCategoryText(item.itemCategory)}}</text>
          <text class="item-status">{{getStatusText(item.status)}}</text>
        </view>
        <view wx:if="{{item.expireAt}}" class="item-expire">
          <text>æœ‰æ•ˆæœŸè‡³ï¼š{{item.expireAt}}</text>
        </view>
      </view>
      <view wx:if="{{item.itemCategory === 'virtual' && item.status === 'unused'}}" class="item-action">
        <button class="use-btn" bindtap="useItem" data-id="{{item._id}}">ä½¿ç”¨</button>
      </view>
    </view>

    <!-- åŠ è½½æ›´å¤š -->
    <view wx:if="{{loading}}" class="loading-more">
      <text>åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>