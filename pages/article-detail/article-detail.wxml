<!--pages/article-detail/article-detail.wxml-->
<view class="article-container">
  <!-- æ–‡ç« å¤´éƒ¨ -->
  <view class="article-header">
    <view class="tag tag-{{article.tagType}}">{{article.tag}}</view>
    <view class="article-title">{{article.title}}</view>
    <view class="article-meta">
      <text class="meta-item">ğŸ“… {{article.time}}</text>
      <text class="meta-item">ğŸ‘ï¸ {{article.views}}</text>
      <text class="meta-item">ğŸ‘ {{article.likes}}</text>
    </view>
  </view>

  <!-- æ–‡ç« å†…å®¹ -->
  <view class="article-content">
    <rich-text nodes="{{article.content}}"></rich-text>
  </view>

  <!-- v3 è¯„è®ºåŒº -->
  <view class="comments-section">
    <view class="section-title">ğŸ’¬ è¯„è®ºåŒº ({{comments.length}})</view>

    <view wx:if="{{comments.length === 0}}" class="empty-comment">æš‚æ— è¯„è®ºï¼Œæ¥æŠ¢æ²™å‘å§</view>

    <view wx:for="{{comments}}" wx:key="_id" class="comment-item {{item.parentId ? 'reply' : ''}}">
      <image class="comment-avatar" wx:if="{{item.authorAvatarUrl}}" src="{{item.authorAvatarUrl}}" mode="aspectFill"
        bindtap="goProfile" data-uid="{{item.authorUid}}"></image>
      <view class="comment-avatar placeholder" wx:else bindtap="goProfile" data-uid="{{item.authorUid}}">ğŸ‘¤</view>
      <view class="comment-body">
        <view class="comment-top">
          <text class="comment-name">{{item.authorNickName || 'æœªè®¾ç½®æ˜µç§°'}}</text>
          <text class="comment-time">{{item.createdAtText}}</text>
        </view>
        <view class="comment-content">
          <text wx:if="{{item.replyToNickName}}" class="reply-to">å›å¤ {{item.replyToNickName}}ï¼š</text>
          {{item.content}}
        </view>
        <view class="comment-actions">
          <text class="reply-btn" bindtap="startReply" data-id="{{item._id}}" data-uid="{{item.authorUid}}" data-name="{{item.authorNickName}}">å›å¤</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç›¸å…³æ–‡ç« æ¨è -->
  <view class="related-section" wx:if="{{relatedArticles.length > 0}}">
    <view class="section-title">ğŸ“š ç›¸å…³æ¨è</view>
    <view 
      wx:for="{{relatedArticles}}" 
      wx:key="id"
      class="related-card"
      bindtap="viewArticle"
      data-id="{{item.id}}"
    >
      <view class="related-title">{{item.title}}</view>
      <view class="related-meta">
        <text>{{item.time}}</text>
        <text>ğŸ‘ï¸ {{item.views}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="article-actions">
    <button class="action-btn" bindtap="handleLike">
      <text class="action-icon">{{liked ? 'â¤ï¸' : 'ğŸ¤'}}</text>
      <text class="action-text">{{liked ? 'å·²ç‚¹èµ' : 'ç‚¹èµ'}}</text>
    </button>
    <button class="action-btn" bindtap="handleCollect">
      <text class="action-icon">{{collected ? 'â­' : 'â˜†'}}</text>
      <text class="action-text">{{collected ? 'å·²æ”¶è—' : 'æ”¶è—'}}</text>
    </button>
    <button class="action-btn" open-type="share">
      <text class="action-icon">ğŸ“¤</text>
      <text class="action-text">åˆ†äº«</text>
    </button>
  </view>

  <!-- v3 è¯„è®ºè¾“å…¥æ  -->
  <view class="comment-input-bar">
    <input class="comment-input" placeholder="{{replyPlaceholder}}" value="{{inputText}}" bindinput="onCommentInput" confirm-type="send" bindconfirm="submitComment" />
    <button class="comment-send" bindtap="submitComment">å‘é€</button>
  </view>
</view>
